<ng-container *ngIf="portion$ | async as portion">
  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav #drawer class="sidenav-drawer" mode="side" position="end">
      <!-- DRAWER CONTENT -->
      <div fxLayout="row" fxLayoutAlign="center center" fxFill>
        <div fxFlex="85" fxLayout="column" fxLayoutAlign="center center" fxFill>
          <div fxFlex="95" fxFill>
            <ng-content select="[drawer]"></ng-content>
          </div>
        </div>
      </div>
    </mat-sidenav>

    <mat-sidenav
      *ngIf="showEndDrawer"
      #endDrawer
      class="sidenav-drawer"
      mode="side"
      position="start"
      [opened]="true"
      [ngStyle]="{ width: (endDrawerSize$ | async) + '%' }"
    >
      <!-- end drawer content -->
      <div fxLayout="row" fxLayoutAlign="stretch stretch" fxFill>
        <div
          fxFlex="100"
          fxLayout="column"
          fxLayoutAlign="stretch stretch"
          fxFill
        >
          <div
            class="end-drawer-button"
            (click)="emitEndDrawer()"
            *ngIf="portion != 1 && portion != 99"
          >
            <!-- end drawer button -->
            <kkl-icon
              [key]="'chevron_left'"
              color="success"
              [size]="4"
            ></kkl-icon>
          </div>

          <ng-content select="[endDrawerContent]"></ng-content>
        </div>
      </div>
    </mat-sidenav>

    <mat-sidenav-content [fxFlex]="portion" fxLayout="column">
      <!-- <div class="stepper-container" fxLayout="column"> -->
      <!-- <mat-toolbar fxLayout="column" class="title" *ngIf="hasTitle">
          <div
            dir="rtl"
            fxLayout="row"
            fxFlex="10rem"
            fxFill
            fxLayoutAlign="center center"
          >
            <div
              fxFlex="90"
              fxLayout="row wrap"
              fxLayoutAlign="space-between center"
            >
              <ng-content select="[title]"></ng-content>
              <ng-content select="[actions]"></ng-content>
            </div>
          </div>
        </mat-toolbar> -->

      <mat-toolbar class="stepper-toolbar" dir="rtl">
        <!-- end drawer Button -->

        <kkl-icon
          *ngIf="portion === 1 || portion === 99"
          [size]="10"
          [key]="'drawer_toggle_icon'"
          (click)="emitEndDrawer()"
          class="end-drawer-btn"
        ></kkl-icon>

        <!-- DRAWER BUTTON  -->

        <div>
          <button
            mat-fab
            (click)="drawer.toggle()"
            [ngClass]="{ open: drawer.opened }"
            [matBadge]="drawer.opened ? 'x' : '+'"
            [matBadgeColor]="drawer.opened ? 'text' : 'accent'"
          >
            <kkl-icon color="accent" [key]="drawerBtn?.icon" [size]="1.8">
            </kkl-icon>
            <kkl-typography [weight]="600" [size]="1">
              {{ drawerBtn.label }}
            </kkl-typography>
          </button>
        </div>

        <!-- STEPPER  -->
        <div class="stepper">
          <ng-container *ngIf="!(mobile$ | async); else mobileBlock">
            <kkl-stepper
              [steps$]="steps$"
              direction="row"
              (changeStep)="onChangeStep($event)"
            ></kkl-stepper>
          </ng-container>

          <ng-template #mobileBlock>
            <kkl-stepper-mobile
              [steps$]="steps$"
              (changeStep)="onChangeStep($event)"
            ></kkl-stepper-mobile>
          </ng-template>
        </div>

        <div class="actions" fxLayout="row" fxLayoutGap="1rem" dir="rtl">
          <ng-container *ngFor="let action of actions">
            <button
              [matTooltip]="action.label"
              mat-icon-button
              kkl-action-button
              color="accent"
              (click)="onAction(action)"
            >
              <mat-icon>{{ action.svgIcon }}</mat-icon>
            </button>
          </ng-container>
        </div>
      </mat-toolbar>
      <!-- </div> -->

      <!-- CONTENT - ROUTER-OUTLET -->
      <div class="content" fxLayout="row" fxFlex fxLayoutAlign="center start">
        <div fxFlex="90" fxFill>
          <ng-content select="[content]"></ng-content>
        </div>
      </div>

      <!-- BOTTOM-NAVBAR CONTENT -->
      <div class="bottom-navbar">
        <div [fxFlex]="portion">
          <ng-content select="[bottom-navbar]"></ng-content>
        </div>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</ng-container>

<ng-template #defaultTemplate> </ng-template>
