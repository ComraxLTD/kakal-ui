<ng-container *ngIf="portion$ | async as portion">
  <mat-sidenav-container class="kkl-sidenav-container" dir="rtl">
    <mat-sidenav #menuDrawer class="menu" mode="push" position="start">
      <ng-container *ngIf="selectedOpen === 'menu'; else elseBlock">
        <div class="menu-container" fxLayout="column" fxLayoutAlign="start end">
          <kkl-menu-bar
            [cards]="cards"
            (menuSelected)="onMenuSelected($event)"
          ></kkl-menu-bar>
        </div>
      </ng-container>

      <ng-template #elseBlock>
        <div
          class="sidenav-drawer"
          fxLayout="row"
          fxLayoutAlign="center center"
          fxFill
        >
          <div
            fxFlex="85"
            fxLayout="column"
            fxLayoutAlign="center center"
            fxFill
          >
            <div fxFlex="95" fxFill>
              <button
                mat-fab
                (click)="onStartSideNav('side')"
                [ngClass]="{
                  'kkl-drawer-button': true,
                  open: menuDrawer.opened
                }"
                [matBadge]="menuDrawer.opened ? 'x' : '+'"
                [matBadgeColor]="menuDrawer.opened ? 'text' : 'primary'"
              >
                <kkl-icon
                  color="primary"
                  [key]="drawerAction?.svgIcon"
                  [size]="1.8"
                >
                </kkl-icon>
                <kkl-typography [weight]="600" [size]="1">
                  {{ drawerAction?.label }}
                </kkl-typography>
              </button>
              <ng-content select="[drawer]"></ng-content>
            </div>
          </div>
        </div>
      </ng-template>
    </mat-sidenav>

    <mat-sidenav
      *ngIf="showEndDrawer"
      #endDrawer
      class="sidenav-drawer"
      [opened]="true"
      fxLayoutAlign="stretch stretch"
      mode="side"
      position="end"
      [ngStyle]="{ width: (endDrawerSize$ | async) + '%' }"
    >
      <!-- end drawer content -->
      <div fxLayout="row" fxFill fxLayoutAlign="stretch stretch">
        <div fxFlex="100" fxLayout="column" fxFill>
          <div
            class="end-drawer-button"
            (click)="emitEndDrawer()"
            *ngIf="portion != 1 && portion != 99"
          >
            <!-- end drawer button -->
            <kkl-icon
              [key]="'chevron_left'"
              color="success"
              [size]="4"
            ></kkl-icon>
          </div>
          <ng-content select="[endDrawerContent]"></ng-content>
        </div>
      </div>
    </mat-sidenav>

    <mat-sidenav-content [fxFlex]="portion">
      <kkl-navbar
        [showStatus$]="showStatus$"
        [isOpen]="menuDrawer.opened"
        (menuToggle)="onStartSideNav('menu')"
        (logoClicked)="onLogoClicked()"
      ></kkl-navbar>

      <kkl-icon
        *ngIf="portion === 1 || portion === 99"
        [size]="10"
        [key]="'drawer_toggle_icon'"
        (click)="emitEndDrawer()"
        class="end-drawer-btn"
      ></kkl-icon>

      <!-- DRAWER BUTTON  -->

      <ng-container *ngIf="showStartDrawer$ | async">
        <button
          mat-fab
          (click)="onStartSideNav('side')"
          [ngClass]="{
            'kkl-drawer-button': true,
            outside: true,
            open: menuDrawer.opened
          }"
          [matBadge]="menuDrawer.opened ? 'x' : '+'"
          [matBadgeColor]="menuDrawer.opened ? 'text' : 'primary'"
        >
          <kkl-icon color="primary" [key]="drawerAction?.svgIcon" [size]="1.8">
          </kkl-icon>
          <kkl-typography [weight]="600" [size]="1">
            {{ drawerAction?.label }}
          </kkl-typography>
        </button>
      </ng-container>

      <ng-content content></ng-content>

      <div class="navbar-bottom">
        <kkl-navbar-bottom></kkl-navbar-bottom>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</ng-container>
