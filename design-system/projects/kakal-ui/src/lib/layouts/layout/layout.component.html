<ng-container *ngIf="portion$ | async as portion">
  <mat-sidenav-container class="kkl-layout" dir="rtl">
    <mat-sidenav #menuDrawer class="menu" mode="push" position="start">
      <ng-container>
        <div
          class="menu-container"
          fxLayout="column"
          fxLayoutAlign=" space-around center"
        >
          <div
            fxFill
            fxLayout="column"
            fxLayoutAlign="center center"
            fxFlex="8rem"
            fxLayoutGap="0.5rem"
            kkl-underline
            kkl-button
            (click)="menuDrawer.toggle()"
          >
            <kkl-icon
              color="primary"
              kkl-button
              [key]="'tree_gradient_' + rootPrefix || 'lands'"
              [size]="4"
            ></kkl-icon>
            <div fxFlex="10" fxLayoutAlign="start center">
              <kkl-typography [size]="1" color="primary">
                סגור תפריט
              </kkl-typography>
            </div>
          </div>
          <kkl-menu-bar
            [cards]="cards"
            (menuSelected)="onMenuSelected($event)"
            [templates]="menuTemplates"
          ></kkl-menu-bar>
        </div>
      </ng-container>
    </mat-sidenav>

    <mat-sidenav
      #endDrawer
      class="sidenav-drawer"
      [opened]="portion.show"
      fxLayoutAlign="stretch stretch"
      mode="side"
      position="end"
      [ngStyle]="{ width: portion.drawer + '%' }"
    >
      <!-- end drawer content -->
      <div fxLayout="row" fxFill fxLayoutAlign="stretch stretch">
        <ng-container *ngIf="portion.hasButton">
          <!-- inner end drawer button -->
          <button
            class="drawer-desktop-btn"
            [disableRipple]="true"
            mat-button
            (click)="onEndDrawerToggle()"
          >
            <mat-icon>chevron_left</mat-icon>
          </button>
        </ng-container>

        <!-- MOBILE BUTTON FOR PORTION DRAWER -->
        <ng-container *ngIf="portion.mobile && endDrawer.opened">
          <kkl-icon
            key="map_mobile_back"
            [size]="12"
            class="drawer-mobile-btn"
            (click)="endDrawer.toggle()"
          ></kkl-icon>
        </ng-container>

        <div fxFlex>
          <ng-content select="[endDrawerContent]"></ng-content>
        </div>
      </div>
    </mat-sidenav>

    <mat-sidenav-content [ngStyle]="{ width: portion.content + '%' }">
      <kkl-navbar
        [status]="status"
        [showStatus$]="showStatus$"
        [isOpen]="menuDrawer.opened"
        (menuToggle)="menuDrawer.toggle()"
        (logoClicked)="onLogoClicked()"
        (statusSelection)="onStatusSelection($event)"
      ></kkl-navbar>

      <ng-content select="[content]"></ng-content>

      <!-- MOBILE BUTTON FOR PORTION DRAWER -->
      <ng-container
        *ngIf="portion.mobile && !endDrawer.opened && portion.hasButton"
      >
        <kkl-icon
          key="map_mobile"
          [size]="12"
          class="drawer-mobile-btn"
          (click)="endDrawer.toggle()"
        ></kkl-icon>
      </ng-container>

      <ng-container *ngIf="!(hideFooter$ | async)">
        <div class="footer" [ngStyle]="{ width: portion.content + '%' }">
          <kkl-navbar-bottom></kkl-navbar-bottom>
        </div>
      </ng-container>
    </mat-sidenav-content>
  </mat-sidenav-container>
</ng-container>
