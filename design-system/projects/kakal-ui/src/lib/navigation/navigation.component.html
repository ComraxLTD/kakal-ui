<div fxFill fxLayout="column" dir="rtl">
  <ng-container *ngIf="stepsSelection$ | async as stepsSelection">
    <nav fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="1.5rem">
      <!-- forward button -->
      <div
        fxLayout="row"
        fxLayoutAlign="center center"
        fxFill
        fxLayoutGap="1.5rem"
        fxFlex
      >
        <button
          mat-icon-button
          (click)="onPrevious(stepsSelection.selectedIndex)"
          [disabled]="stepsSelection.first"
        >
          <kkl-icon key="arrow_forward_ios" color="primary"></kkl-icon>
        </button>

        <!-- show current ui -->

        <ng-container
          *ngTemplateOutlet="
            template || defaultTemplate;
            context: { $implicit: stepsSelection }
          "
        ></ng-container>

        <!-- previous button -->

        <button
          mat-icon-button
          (click)="onNext(stepsSelection.selectedIndex)"
          [disabled]="stepsSelection.last"
        >
          <kkl-icon key="arrow_back_ios" color="primary"></kkl-icon>
        </button>
      </div>

      <!-- steps items -->
      <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="2rem">
        <ng-container *ngFor="let item of stepsSelection.source; let i = index">
          <div
            kkl-border
            kkl-button
            (click)="onStepSelect(i)"
            [ngClass]="{
              selected: stepsSelection.selectedIndex === i,
              button: true
            }"
          ></div>
        </ng-container>
      </div>
    </nav>
  </ng-container>
</div>

<ng-template #defaultTemplate let-stepsSelection>
  <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="1.5rem">
    <kkl-typography [size]="1.8" [bold]="600">{{
      stepsSelection.selectedStep | pluck: "label"
    }}</kkl-typography>
  </div>
</ng-template>
