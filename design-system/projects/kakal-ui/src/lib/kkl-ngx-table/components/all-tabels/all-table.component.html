<!-- <ng-container *ngIf="noMobile || !(mobile$ | async); else webBlock"> -->
<div class="all-table-form" (resized)="onResize($event)" #myIdentifier>
  <div
    fxLayout="column"
    fxLayoutAlign=" start"
    fxLayoutGap="1rem"
    [ngClass]="{ 'hidden-class': !isDesktop }"
  >
    <ng-container *ngIf="newRowAction">
      <button
        kkl-border
        table-add-button
        [thick]="2"
        mat-stroked-button
        color="primary"
        (click)="addNewRowGroup()"
      >
        <span>
          {{ newRowAction }}
        </span>
        <mat-icon color="primary">add</mat-icon>
      </button>
    </ng-container>
    <div class="table-wrapper">
      <!-- cdkDropList
      (cdkDropListDropped)="dropTable($event)" [cdkDropListDisabled]="dragDisabled"> -->
      <!-- [cdkDropListData]="dataTable" -->
      <mat-progress-bar
        mode="indeterminate"
        *ngIf="isLoading"
      ></mat-progress-bar>

      <!-- [scrollbarV]="true" -->
      <ngx-datatable
        dir="rtl"
        #myTable
        class="expandable"
        [columnMode]="ColumnMode.force"
        [headerHeight]="50"
        [footerHeight]="65"
        rowHeight="auto"
        [rows]="dataTable"
        [offset]="page.pageIndex"
        [limit]="page.pageSize"
        [rowClass]="getRowClass"
      >
        <!-- Row Detail Template -->
        <ngx-datatable-row-detail [rowHeight]="expandHeight" #myDetailRow>
          <ng-template
            let-row="row"
            let-expanded="expanded"
            let-co="col"
            ngx-datatable-row-detail-template
          >
            <div *ngIf="expanded" class="example-element-detail" #myExpand>
              <ng-container *ngIf="expandTemplate">
                <ng-template
                  *ngTemplateOutlet="
                    expandTemplate;
                    context: { $implicit: row }
                  "
                ></ng-template>
              </ng-container>
            </div>
          </ng-template>
        </ngx-datatable-row-detail>
        <!-- Column Templates -->
        <!-- <ngx-datatable-column
          [width]="50"
          [resizeable]="false"
          [sortable]="false"
          [draggable]="false"
          [canAutoResize]="false"
        >
          <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
            <a
              href="javascript:void(0)"
              [class.datatable-icon-right]="!expanded"
              [class.datatable-icon-down]="expanded"
              title="Expand/Collapse Row"
              (click)="toggleExpandRow(row)"
            >
            </a>
          </ng-template>
        </ngx-datatable-column> -->
        <ngx-datatable-column
          *ngFor="let column of oneColumns"
          [name]="column.key"
        >
          <!-- style="background-color: blue;" -->
          <ng-template let-sort="sortFn" ngx-datatable-header-template>
            <!-- column.controlType === 'number' || column.controlType === 'sum' -->
            <span (click)="sort()">{{ column.label }}</span>
            <button
              *ngIf="!column.noFilter"
              mat-icon-button
              [matMenuTriggerFor]="menu"
            >
              <!-- <kkl-icon class="arrow-down" key="arrow_drop_down"></kkl-icon> -->
              <mat-icon class="arrow-down">arrow_drop_down</mat-icon>
            </button>
            <mat-menu #menu="matMenu" (closed)="searchChanged()">
              <kkl-ngx-table-form
                [question]="column"
                (rowEdited)="updateFilter($event, column.key)"
              ></kkl-ngx-table-form>
            </mat-menu>
          </ng-template>
          <ng-template
            let-row="row"
            let-value="value"
            ngx-datatable-cell-template
          >
            <ng-container
              *ngIf="
                !(row | arrInclueds: editItems) || column.notEditable;
                else editBlock
              "
            >
              <kkl-table-cell
                [data]="value"
                [question]="column"
                (buttClick)="buttonClick(column.button, row, column.key)"
                [colsTemplate]="colsTemplate"
              ></kkl-table-cell>
            </ng-container>
            <ng-template #editBlock>
              <kkl-ngx-table-form
                [initial]="editItemsData[row | arrIndex: editItems]"
                [question]="column"
                (rowEdited)="onRowEditChange($event, row, column.key)"
              ></kkl-ngx-table-form>
            </ng-template>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="פעולות">
          <ng-template
            let-row="row"
            let-rowIndex="rowIndex"
            ngx-datatable-cell-template
          >
            <ng-container
              *ngIf="!(row | arrInclueds: editItems); else addButton"
            >
              <ng-container *ngFor="let butt of localButtons">
                <button
                  [matTooltip]="butt.label"
                  mat-button
                  color="primary"
                  (click)="buttonClick(butt, row, 'actions')"
                >
                  <kkl-icon *ngIf="butt.icon" [key]="butt.icon"></kkl-icon>
                </button>
              </ng-container>
            </ng-container>
            <ng-template #addButton>
              <button
                matTooltip="save"
                mat-button
                color="primary"
                (click)="saveRowClick(row)"
              >
                <kkl-icon key="save"></kkl-icon>
              </button>
              <button
                matTooltip="cancel"
                mat-button
                color="primary"
                (click)="cancelRowClick(row)"
              >
                <kkl-icon key="cancel"></kkl-icon>
              </button>
            </ng-template>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-footer>
          <ng-template
            ngx-datatable-footer-template
            let-rowCount="rowCount"
            let-pageSize="pageSize"
            let-selectedCount="selectedCount"
            let-curPage="curPage"
            let-offset="offset"
            let-isVisible="isVisible"
          >
            <div class="container">
              <ng-container *ngIf="paging">
                <mat-paginator
                  #myPaging
                  dir="ltr"
                  fxLayout="row"
                  fxLayoutAlign="center center"
                  kklNewPagination
                  [pageIndex]="offset"
                  [pageSize]="pageSize"
                  [length]="rowCount"
                  [pageSizeOptions]="[5, 10, 25]"
                  (page)="pageChanged($event)"
                ></mat-paginator>
              </ng-container>
            </div>
          </ng-template>
        </ngx-datatable-footer>
      </ngx-datatable>
    </div>
  </div>
</div>
