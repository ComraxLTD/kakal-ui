<div fxLayout="column" class="kkl-form-search">
  <header class="kkl-form-search" fxLayout="row" fxLayoutAlign="space-between center" *ngIf="allSearch?.length > 0">
    <kkl-form
      fxFlex="90"
      [controls]="[allSearch[0]]"
      [options]="myOptions"
      [formGroup]="formGroup"

      [rowHeight]="rowHeight"

      (selectChanged)="onSelectChanged($event)"
      (openedChange)="onOpenedChange($event)"
      (queryChanged)="onQueryChanged($event)"
      (valueChanged)="onValueChanged($event)"
      (focusChanged)="onFocusChanged($event)"
      (submitEvent)="onSubmitEvent($event)"
    ></kkl-form>

    <div kkl-form-button *ngIf="myQuestions?.length > 0">
      <button [disableRipple]="true" mat-icon-button kkl-action-button (click)="onClick()">
        <kkl-icon [color]="'primary'" [key]="expended ? 'keyboard_double_arrow_up' : 'keyboard_double_arrow_down'"></kkl-icon>
      </button>
    </div>
  </header>

  <!-- expand panel section -->
  <main *ngIf="myQuestions?.length > 0">
    <mat-accordion class="kkl-form-search">
      <mat-expansion-panel class="kkl-form-search" class="mat-elevation-z0" [expanded]="expended">
        <kkl-form
          [controls]="myQuestions"
          [options]="myOptions"
          [formGroup]="formGroup"

          [grid]="grid"
          [rowHeight]="rowHeight"
          [templates]="templates"
          [buttonLabel]="buttonLabel"

          (selectChanged)="onSelectChanged($event)"
          (openedChange)="onOpenedChange($event)"
          (queryChanged)="onQueryChanged($event)"
          (valueChanged)="onValueChanged($event)"
          (focusChanged)="onFocusChanged($event)"
          (submitEvent)="onSubmitEvent($event)"
        ></kkl-form>
      </mat-expansion-panel>
    </mat-accordion>
  </main>

  <!-- FILTER CHIPS SECTION -->

  <ng-container *ngIf="allSearch?.length > 0 || columns?.length > 0">
    <kkl-filters
      [controls]="allSearch?.concat(columns)"
      [formGroup]="formGroup"
      (selectChanged)="onSelectChangedFilter($event)"
      (valueChanged)="onValueChangedFilter($event)"
    ></kkl-filters>
  </ng-container>
</div>


<ng-container *ngIf="typeLocal;else serverTable">
  <kkl-local-table
    #localTable
    [expandTemplate]="expandTemplate"
    [searchRow]="formGroup"
    [options]="myOptions"
    [colsTemplate]="colsTemplate"
    [newRowAction]="newRowAction"
    [paging]="paging"
    [dragable]="dragable"
    [columns]="columns"
    [dataSource]="dataSource"
    [rowActions]="rowActions"
    (actionClicked)="onActionClicked($event)"
    (deleteRow)="onDeleteRow($event)"
    (saveRow)="onSaveRow($event)"
    (expandRow)="onExpandRow($event)"
  ></kkl-local-table>
</ng-container>
<ng-template #serverTable>
  <kkl-server-table
    #eventTable
    [expandTemplate]="expandTemplate"
    [searchRow]="formGroup"
    [options]="myOptions"
    [colsTemplate]="colsTemplate"
    [newRowAction]="newRowAction"
    [paging]="paging"
    [dragable]="dragable"
    [columns]="columns"
    [dataSourceUrl]="dataSourceUrl"
    [dataSourceServer]="dataSourceServer"
    [rowActions]="rowActions"
    (actionClicked)="onActionClicked($event)"
    (deleteRow)="onDeleteRow($event)"
    (saveRow)="onSaveRow($event)"
    (expandRow)="onExpandRow($event)"
    (requestChanged)="onSearchChanged($event)"
  ></kkl-server-table>
</ng-template>
