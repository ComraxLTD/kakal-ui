<div fxFill>
  <!-- BUTTON SECTION -->
  <div
    kkl-button
    color="primary"
    [matMenuTriggerFor]="menu"
    (menuOpened)="onMenuOpen(optionFlag)"
  >
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <kkl-typography>
        {{ column.label }}
      </kkl-typography>
      <mat-icon color="primary"> arrow_drop_down </mat-icon>
    </div>
  </div>

  <!-- MENU SECTION -->
  <mat-menu #menu="matMenu" xPosition="after">
    <div class="filter-menu" fxLayout="column">
      <div fxLayout="row" fxLayoutGap="1rem" (click)="$event.stopPropagation()">
        <ng-container [ngSwitch]="column.filterType">
          <!-- DATES FILTER-->
          <ng-container *ngSwitchCase="'dateRange'">
            <kkl-filter-range-cell
              fxFlex="75"
              [column]="column"
              (rangeChange)="onRangeChange($event)"
            ></kkl-filter-range-cell>
          </ng-container>

          <!-- CURRENCY FILTER-->

          <ng-container *ngSwitchCase="'numberRange'">
            <kkl-filter-range-cell
              fxFlex="75"
              [column]="column"
              (rangeChange)="onRangeChange($event)"
            ></kkl-filter-range-cell>
          </ng-container>

          <ng-container *ngSwitchDefault>
            <kkl-form-input
              fxFlex="75"
              [control]="control"
              [key]="column.columnDef"
              [icon]="'search'"
              (valueChanged)="onValueChanged($event)"
            >
            </kkl-form-input>
          </ng-container>
        </ng-container>

        <!-- SORT BUTTON -->
        <div class="sort-button" fxLayout="column" fxLayoutAlign="end center">
          <div fxFlex="95">
            <kkl-sort-button
              (sortChange)="onSortChange($event)"
              [sortBy]="column.sortDir"
            ></kkl-sort-button>
          </div>
        </div>
      </div>
      <ng-controller
        *ngIf="
          column.filterType === 'select' || column.filterType === 'multiSelect'
        "
      >
        <mat-selection-list
          #list
          (selectionChange)="onSelectionChange(list.selectedOptions.selected)"
          [multiple]="column.filterType === 'multiSelect'"
          dir="rtl"
        >
          <ng-container *ngFor="let option of options$ | async">
            <mat-list-option
              (click)="$event.stopPropagation()"
              [value]="option"
              [selected]="option.selected"
            >
              <kkl-typography> {{ option.label }}</kkl-typography>
            </mat-list-option>
          </ng-container>
        </mat-selection-list>
      </ng-controller>
    </div>
  </mat-menu>
</div>
