<mat-form-field
  [color]="theme"
  [appearance]="control.disabled ? 'fill' : appearance || 'outline'"
>
  <mat-label>{{ label }}</mat-label>

  <mat-select
    panelClass="select-panel-form"
    overlayPanelClass="overlay-panel"
    [multiple]="multi"
    [disableOptionCentering]="true"
    (selectionChange)="onSelectChange()"
    [formControl]="control"
    [attr.name]="key"
    [compareWith]="compareFunction"
    (focusout)="setErrorMessage()"
    (focus)="onFocus()"
  >
    <mat-select-trigger *ngIf="multi">
      {{ control.value ? control.value[0]?.label : "" }}
      <span *ngIf="control.value?.length > 1">
        (+{{ control.value.length - 1 }})
      </span>
    </mat-select-trigger>
    <mat-option *ngFor="let option of options" [value]="option">
      {{ option.label }}
    </mat-option>
  </mat-select>
  <kkl-icon
    matSuffix
    [size]="1.8"
    color="primary"
    key="keyboard_arrow_down"
  ></kkl-icon>
  <mat-error>{{ error$ | async }}</mat-error>
</mat-form-field>
