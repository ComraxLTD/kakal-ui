<form
  [fxLayout]="variant + ' wrap'"
  fxLayoutAlign="start center"
  [formGroup]="formGroup"
  (ngSubmit)="onSubmit()"
>
  <ng-container *ngFor="let question of questions; let index = index">
    <ng-container [ngSwitch]="question.controlType">
      <div
        [class.input-container]="true"
        [class.odd]="odd"
        [class.even]="even"
        [fxFlex]="flex"
      >
        <!-- SELECT INPUT SECTION -->
        <ng-container *ngSwitchCase="'select'">
          <kkl-form-select
            [control]="formGroup.controls[question.key]"
            [key]="question?.key"
            [multi]="question?.multi"
            [options]="question?.options"
            [index]="index"
            [label]="question?.label"
            [placeHolder]="question?.placeHolder"
            [theme]="question?.theme"
            [appearance]="question?.appearance"
            (focus)="onFocus($event)"
            [optionsSlot]="optionsSlot"
            (selected)="onSelect($event)"
          ></kkl-form-select>
        </ng-container>

        <!-- DATE INPUT SECTION -->
        <ng-container *ngSwitchCase="'dateRange'">
          <kkl-form-date-range
            [formControl]="formGroup.controls[question.key]"
            [key]="question?.key"
            [label]="question?.label"
            [placeHolder]="question?.placeHolder"
            [maxDate]="question?.maxDate"
            [minDate]="question?.minDate"
            [appearance]="question?.appearance"
            [index]="index"
          >
          </kkl-form-date-range>
        </ng-container>

        <!-- DATE INPUT SECTION -->
        <ng-container *ngSwitchCase="'date'">
          <kkl-form-date
            [control]="formGroup.controls[question.key]"
            [key]="question?.key"
            [label]="question?.label"
            [placeHolder]="question?.placeHolder"
            [maxDate]="question?.maxDate"
            [minDate]="question?.minDate"
            [appearance]="question?.appearance"
            [index]="index"
            (focus)="onFocus($event)"
          >
          </kkl-form-date>
        </ng-container>

        <!-- DATE INPUT SECTION -->
        <ng-container *ngSwitchCase="'range'">
          <kkl-form-range
            [formControl]="formGroup.controls[question.key]"
            [questions]="question.questions"
            [index]="index"
            [label]="question.label"
            [key]="question.key"
          ></kkl-form-range>
        </ng-container>
        <!-- DATE INPUT SECTION -->
        <ng-container *ngSwitchCase="'autocomplete'">
          <kkl-form-autocomplete
            (queryChanged)="onQueryChanged($event)"
            [key]="question?.key"
            [multi]="question.multi"
            [options]="question.options"
            [control]="formGroup.controls[question.key]"
            (multiOptionsSelected)="onMultiOptionSelected($event)"
            (optionSelected)="onOptionSelected($event)"
          ></kkl-form-autocomplete>
        </ng-container>

        <!-- FILE INPUT SECTION -->
        <ng-container *ngSwitchCase="'upload'">
          <kkl-form-upload
            [label]="question?.label"
            [multi]="question?.multi"
            [formControl]="formGroup.controls[question.key]"
            [index]="index"
          ></kkl-form-upload>
        </ng-container>

        <!-- CURRENCY INPUT SECTION -->
        <ng-container *ngSwitchCase="'currency'">
          <kkl-form-currency
            [key]="question?.key"
            [formControl]="formGroup.controls[question.key]"
            [validations]="question?.validations"
            [options]="question?.options"
            [default]="question?.default"
            [index]="index"
          >
          </kkl-form-currency>
        </ng-container>

        <!-- DEFAULT INPUT -->
        <ng-container *ngSwitchDefault>
          <kkl-form-input
            [control]="formGroup.controls[question.key]"
            [key]="question?.key"
            [placeHolder]="question?.placeHolder"
            [theme]="question?.theme"
            [appearance]="question?.appearance"
            [cleave]="question?.cleave"
            [icon]="question?.icon"
            [label]="question?.label"
            [index]="index"
            (focus)="onFocus($event)"
            [controlType]="question?.controlType"
          ></kkl-form-input>
        </ng-container>
      </div>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="hasButton">
    <div [class.button-container]="true" fxFlex kkl-form-button>
      <ng-container
        *ngTemplateOutlet="
          buttonTemp || defaultTemplate;
          context: { $implicit: formGroup }
        "
      ></ng-container>
    </div>
  </ng-container>
</form>

<ng-template #defaultTemplate let-formGroup>
  <kkl-stroke-button
    type="submit"
    color="primary"
    [disabled]="!formGroup.valid"
    >{{ buttonLabel }}</kkl-stroke-button
  >
</ng-template>
