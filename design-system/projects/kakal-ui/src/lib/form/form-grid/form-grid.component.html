<form (ngSubmit)="onSubmit()" [formGroup]="group.formGroup">
  <mat-grid-list
    [cols]="cols"
    [rowHeight]="(rowHeight || 9) + 'rem'"
    [gutterSize]="(gutter || 1) + 'rem'"
    [dir]="'rtl'"
  >
    <ng-container *ngFor="let question of group.questions; let index = index">
      <ng-container [ngSwitch]="question.controlType">
        <!-- GROUP INPUT SECTION -->
        <ng-container *ngSwitchCase="'group'">
          <ng-container *ngFor="let q of question.questions; let first = first">
            <div
              fxFill
              [fxLayoutAlign]="
                question?.gridProps?.flex?.align || 'center' + ' center'
              "
            >
              <div [fxFlex]="question?.gridProps?.flex?.width || 100">
                <mat-grid-tile
                  [colspan]="
                    q?.gridProps?.fullWidth ? cols : q?.gridProps?.cols || 1
                  "
                  [rowspan]="q?.gridProps?.rows || 1"
                >
                  <div fxLayout="column" fxFill fxLayoutGap="1rem">
                    <div fxFlex="1rem">
                      <kkl-typography
                        color="primary"
                        [bold]="600"
                        *ngIf="question.label && first"
                        >{{ question.label }}
                      </kkl-typography>
                    </div>
                    <div
                      [fxLayoutAlign]="
                        q?.gridProps?.flex?.align || 'center' + ' center'
                      "
                    >
                      <div [fxFlex]="q?.gridProps?.flex?.width || 100">
                        <kkl-form-input
                          [control]="
                            group.formGroup.controls[question.key].controls[
                              q.key
                            ]
                          "
                          [key]="q?.key"
                          [placeHolder]="q?.placeHolder"
                          [theme]="q?.theme"
                          [appearance]="q?.appearance"
                          [cleave]="q?.cleave"
                          [gridProps]="q?.gridProps"
                          [icon]="q?.icon"
                          [label]="q?.label"
                          [index]="index"
                          (focus)="formChangeEvent($event)"
                          [controlType]="q?.controlType"
                        >
                        </kkl-form-input>
                      </div>
                    </div>
                  </div>
                </mat-grid-tile>
              </div>
            </div>
          </ng-container>
        </ng-container>
        <!-- SELECT INPUT SECTION -->
        <ng-container *ngSwitchCase="'select'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-select
              fxFlex="100"
              [control]="group.formGroup.controls[question.key]"
              [key]="question?.key"
              [multi]="question?.multi"
              [options]="question?.options"
              [index]="index"
              [placeHolder]="question?.placeHolder"
              [theme]="question?.theme"
              [appearance]="question?.appearance"
              [optionsSlot]="optionsSlot"
              (focus)="formChangeEvent($event)"
              (selectChanged)="formChangeEvent($event)"
            ></kkl-form-select>
          </mat-grid-tile>
        </ng-container>
        <!-- CHECKBOX INPUT SECTION -->
        <ng-container *ngSwitchCase="'checkbox'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-checkbox
              fxFlex="100"
              [control]="group.formGroup.controls[question.key]"
              [key]="question?.key"
              [options]="question?.options"
            ></kkl-form-checkbox>
          </mat-grid-tile>
        </ng-container>
        <!-- RADIO BUTTON INPUT SECTION -->
        <ng-container *ngSwitchCase="'radio'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-radio
              fxFlex="100"
              [control]="group.formGroup.controls[question.key]"
              [key]="question?.key"
              [options]="question?.options"
            ></kkl-form-radio>
          </mat-grid-tile>
        </ng-container>
        <!-- DATE INPUT SECTION -->
        <ng-container *ngSwitchCase="'date'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-date
              fxFlex="100"
              [control]="group.formGroup.controls[question.key]"
              [key]="question?.key"
              [range]="question?.range"
              [placeHolder]="question?.placeHolder"
              [maxDate]="question?.maxDate"
              [minDate]="question?.minDate"
              [appearance]="question?.appearance"
              [index]="index"
              (focus)="formChangeEvent($event)"
            >
            </kkl-form-date>
          </mat-grid-tile>
        </ng-container>

        <!-- FILE INPUT SECTION -->
        <ng-container *ngSwitchCase="'upload'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-upload
              fxFlex="100"
              [label]="question?.label"
              [multi]="question?.multi"
              [formControl]="group.formGroup.controls[question.key]"
              [index]="index"
              (fileChanged)="formChangeEvent($event)"
            ></kkl-form-upload>
          </mat-grid-tile>
        </ng-container>

        <!-- CURRENCY INPUT SECTION -->
        <ng-container *ngSwitchCase="'currency'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-currency
              fxFlex="100"
              [formControl]="group.formGroup.controls[question.key]"
              [validations]="question?.validations"
              [index]="index"
            >
            </kkl-form-currency>
          </mat-grid-tile>
        </ng-container>
        <!-- TEXTEDITOR INPUT SECTION -->
        <ng-container *ngSwitchCase="'textEditor'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <kkl-form-texteditor
              fxFlex="100"
              [control]="group.formGroup.controls[question.key]"
              [placeHolder]="question?.placeHolder"
              [validations]="question?.validations"
              [index]="index"
            >
            </kkl-form-texteditor>
          </mat-grid-tile>
        </ng-container>
        <!-- CUSTOM INPUT SECTION -->
        <ng-container *ngSwitchCase="'custom'">
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <ng-container
              *ngTemplateOutlet="
                slots[question.key];
                context: {
                  question: question,
                  control: group.formGroup.controls[question.key]
                }
              "
            >
            </ng-container>
          </mat-grid-tile>
        </ng-container>

        <!-- DEFAULT INPUT -->
        <ng-container *ngSwitchDefault>
          <mat-grid-tile
            [colspan]="
              question?.gridProps?.fullWidth
                ? cols
                : question?.gridProps?.cols || 1
            "
            [rowspan]="question?.gridProps?.rows || 1"
          >
            <div
              fxFill
              [fxLayoutAlign]="
                question?.gridProps?.flex?.align || 'center' + ' center'
              "
            >
              <div [fxFlex]="question?.gridProps?.flex?.width || 100">
                <kkl-form-input
                  [control]="group.formGroup.controls[question.key]"
                  [key]="question?.key"
                  [placeHolder]="question?.placeHolder"
                  [theme]="question?.theme"
                  [appearance]="question?.appearance"
                  [cleave]="question?.cleave"
                  [gridProps]="question?.gridProps"
                  [icon]="question?.icon"
                  [label]="question?.label"
                  [index]="index"
                  (focus)="formChangeEvent($event)"
                  [controlType]="question?.controlType"
                >
                </kkl-form-input>
              </div>
            </div>
          </mat-grid-tile>

          <mat-grid-tile *ngIf="question?.gridProps?.offset"> </mat-grid-tile>
        </ng-container>
      </ng-container>
    </ng-container>

    <mat-grid-tile
      *ngIf="hasButton"
      [colspan]="group?.gridProps.buttonCols || 1"
    >
      <div class="btn-form" fxFlex="100">
        <ng-container
          *ngTemplateOutlet="
            slots?.button;
            context: {
              $implicit: group.formGroup.value,
              $implicit: group.formGroup.disabled,
              $implicit: group.formGroup.valid
            }
          "
        >
        </ng-container>
      </div>
    </mat-grid-tile>
  </mat-grid-list>
</form>
