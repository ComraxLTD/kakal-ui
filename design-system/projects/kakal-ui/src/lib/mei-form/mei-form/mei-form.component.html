<ng-container [ngSwitch]="variant">
  <ng-container *ngSwitchCase="'grid'">
    <form (ngSubmit)="onSubmitEvent()" [formGroup]="formGroup" autocomplete="off">
      <mat-grid-list [cols]="cols" [rowHeight]="(rowHeight || 9) + 'rem'" [gutterSize]="(gutter) + 'rem'"[dir]="'rtl'">
        <ng-container *ngFor="let question of myQuestions; let index = index">
          <ng-container [ngSwitch]="question.controlType">


            <ng-container *ngSwitchCase="'select'">
              <mat-grid-tile [colspan]=" question?.gridProps?.fullWidth? cols : question?.gridProps?.cols || 1" [rowspan]="question?.gridProps?.rows || 1">
                <mei-select
                  fxFlex="100"
                  [control]="formGroup.controls[question.key]"
                  [options]="question.options"
                  [multi]="question.multi"
                  [placeHolder]="question.placeHolder"
                  [key]="question.key"
                  [label]="question.label"
                  [theme]="question.theme"
                  [appearance]="question.appearance"
                  [disabled]="question.disabled"
                  (selectChanged)="onSelectChanged($event)"
                  (openChanged)="onOpenChanged($event)"
                ></mei-select>
              </mat-grid-tile>
            </ng-container>
            <ng-container *ngSwitchCase="'autocomplete'">
              <ng-container *ngIf="question.multi; else simpleAutocomplete">
                <mei-multi-autocomplete
                  [control]="formGroup.controls[question.key]"
                  [options]="question.options"
                  [placeHolder]="question.placeHolder"
                  [key]="question.key"
                  [label]="question.label"
                  [debounce]="question.debounce"
                  [appearance]="question.appearance"
                  [disabled]="question.disabled"
                  [withButton]="question.withButton"
                  [icon]="question.icon"
                  [panelWidth]="question.panelWidth"
                  (queryChanged)="onQueryChanged($event)"
                  (selectChanged)="onSelectChanged($event)"
                  (openChanged)="onOpenChanged($event)">
                </mei-multi-autocomplete>
              </ng-container>
              <ng-template #simpleAutocomplete>
                <mei-autocomplete
                  [control]="formGroup.controls[question.key]"
                  [options]="question.options"
                  [placeHolder]="question.placeHolder"
                  [key]="question.key"
                  [label]="question.label"
                  [debounce]="question.debounce"
                  [appearance]="question.appearance"
                  [disabled]="question.disabled"
                  [withButton]="question.withButton"
                  [icon]="question.icon"
                  [panelWidth]="question.panelWidth"
                  (queryChanged)="onQueryChanged($event)"
                  (selectChanged)="onSelectChanged($event)"
                  (openChanged)="onOpenChanged($event)"
                ></mei-autocomplete>
              </ng-template>
            </ng-container>
            <ng-container *ngSwitchCase="'date'">
              <mat-grid-tile [colspan]="question?.gridProps?.fullWidth? cols : question?.gridProps?.cols || 1" [rowspan]="question?.gridProps?.rows || 1">
                <mei-datepicker
                  fxFlex="100"
                  [label]="question.label"
                  [control]="formGroup.controls[question.key]"
                  [key]="question.key"
                  [placeHolder]="question.placeHolder"
                  [maxDate]="question.maxDate"
                  [minDate]="question.minDate"
                  [appearance]="question.appearance"
                  (focusChanged)="onFocusChanged($event)"
                  (valueChanged)="onValueChanged($event)"
                >
                </mei-datepicker>
              </mat-grid-tile>
            </ng-container>
            <ng-container *ngSwitchCase="'dateRange'">
              <mat-grid-tile [colspan]="question?.gridProps?.fullWidth? cols : question?.gridProps?.cols || 1" [rowspan]="question?.gridProps?.rows || 1">
                <mei-range-datepicker
                  fxFlex="100"
                  [groupControl]="formGroup.controls[question.key]"
                  [key]="question?.key"
                  [label]="question?.label"
                  [appearance]="question?.appearance"
                  (focusChanged)="onFocusChanged($event)"
                  (valueChanged)="onValueChanged($event)"
                >
                </mei-range-datepicker>
              </mat-grid-tile>
            </ng-container>
            <ng-container *ngSwitchDefault>
              <mat-grid-tile [colspan]="question?.gridProps?.fullWidth? cols : question?.gridProps?.cols || 1" [rowspan]="question?.gridProps?.rows || 1">
                <div fxFill [fxLayoutAlign]="question?.gridProps?.flex?.align || 'center' + ' center'">
                  <div [fxFlex]="question?.gridProps?.flex?.width || 100">
                    <mei-input
                      [control]="formGroup.controls[question.key]"
                      [label]="question.label"
                      [key]="question.key"
                      [placeHolder]="question.placeHolder"
                      [theme]="question.theme"
                      [appearance]="question.appearance"
                      [gridProps]="question.gridProps"
                      [icon]="question.icon"
                      [controlType]="question?.controlType"
                      (focusChanged)="onFocusChanged($event)"
                      (valueChanged)="onValueChanged($event)"
                    >
                    </mei-input>
                  </div>
                </div>
              </mat-grid-tile>

              <mat-grid-tile *ngIf="question?.gridProps?.offset"> </mat-grid-tile>
            </ng-container>
          </ng-container>
        </ng-container>

        <mat-grid-tile *ngIf="hasButton" [colspan]="group?.gridProps.buttonCols || 1">
          <div class="btn-form" fxFlex="100">
            <ng-container *ngTemplateOutlet=" buttonTemp || defaultTemplate; context: {$implicit: formGroup}">
            </ng-container>
          </div>
        </mat-grid-tile>
      </mat-grid-list>
    </form>

  </ng-container>


  <ng-container *ngSwitchCase="'flex'">
    <form (ngSubmit)="onSubmitEvent()" [formGroup]="formGroup" [fxLayout]="layout + ' wrap'" fxLayoutAlign="start center" autocomplete="off">
      <ng-container *ngFor="let question of myQuestions; let index = index">
        <ng-container [ngSwitch]="question.controlType">
          <div flex-form-input [index]="index" [cols]="cols" [offset]="16" [fxFlex]="flex">
          <!-- SELECT INPUT SECTION -->
            <ng-container *ngSwitchCase="'select'">
                <mei-select
                  [control]="formGroup.controls[question.key]"
                  [options]="question.options"
                  [multi]="question.multi"
                  [placeHolder]="question.placeHolder"
                  [key]="question.key"
                  [label]="question.label"
                  [theme]="question.theme"
                  [appearance]="question.appearance"
                  [disabled]="question.disabled"
                  (selectChanged)="onSelectChanged($event)"
                  (openChanged)="onOpenChanged($event)"
                ></mei-select>
            </ng-container>
            <ng-container *ngSwitchCase="'autocomplete'">
              <ng-container *ngIf="question.multi; else simpleAutocomplete">
                <mei-multi-autocomplete
                  [control]="formGroup.controls[question.key]"
                  [options]="question.options"
                  [placeHolder]="question.placeHolder"
                  [key]="question.key"
                  [label]="question.label"
                  [debounce]="question.debounce"
                  [appearance]="question.appearance"
                  [disabled]="question.disabled"
                  [withButton]="question.withButton"
                  [icon]="question.icon"
                  [panelWidth]="question.panelWidth"
                  (queryChanged)="onQueryChanged($event)"
                  (selectChanged)="onSelectChanged($event)"
                  (openChanged)="onOpenChanged($event)">
                </mei-multi-autocomplete>
              </ng-container>
              <ng-template #simpleAutocomplete>
                <mei-autocomplete
                  [control]="formGroup.controls[question.key]"
                  [options]="question.options"
                  [placeHolder]="question.placeHolder"
                  [key]="question.key"
                  [label]="question.label"
                  [debounce]="question.debounce"
                  [appearance]="question.appearance"
                  [disabled]="question.disabled"
                  [withButton]="question.withButton"
                  [icon]="question.icon"
                  [panelWidth]="question.panelWidth"
                  (queryChanged)="onQueryChanged($event)"
                  (selectChanged)="onSelectChanged($event)"
                  (openChanged)="onOpenChanged($event)"
                ></mei-autocomplete>
              </ng-template>
            </ng-container>
            <ng-container *ngSwitchCase="'date'">
              <mei-datepicker
                [control]="formGroup.controls[question.key]"
                [key]="question.key"
                [label]="question.label"
                [placeHolder]="question.placeHolder"
                [maxDate]="question.maxDate"
                [minDate]="question.minDate"
                [appearance]="question.appearance"
                (focusChanged)="onFocusChanged($event)"
                (valueChanged)="onValueChanged($event)"
              ></mei-datepicker>
            </ng-container>
            <ng-container *ngSwitchCase="'range'">
              <mei-range-datepicker
                [groupControl]="formGroup.controls[question.key]"
                [key]="question?.key"
                [label]="question?.label"
                [appearance]="question?.appearance"
                (focusChanged)="onFocusChanged($event)"
                (valueChanged)="onValueChanged($event)"
              ></mei-range-datepicker>
            </ng-container>
            <ng-container *ngSwitchDefault>
              <mei-input
                [control]="formGroup.controls[question.key]"
                [label]="question.label"
                [key]="question.key"
                [placeHolder]="question.placeHolder"
                [theme]="question.theme"
                [appearance]="question.appearance"
                [icon]="question.icon"
                [controlType]="question.controlType"
                (focusChanged)="onFocusChanged($event)"
                (valueChanged)="onValueChanged($event)"
              ></mei-input>
            </ng-container>

          </div>

        </ng-container>
      </ng-container>

      <ng-container *ngIf="hasButton">
        <div [class.button-container]="true" fxFlex kkl-form-button>
          <ng-container *ngTemplateOutlet=" buttonTemp || defaultTemplate; context: { $implicit: formGroup }"
          ></ng-container>
        </div>
      </ng-container>

    </form>

  </ng-container>
</ng-container>


<ng-template #defaultTemplate let-formGroup>
  <kkl-stroke-button
    type="submit"
    color="primary"
    [disabled]="!formGroup.valid"
    >{{ buttonLabel }}</kkl-stroke-button
  >
</ng-template>
